!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/common","@angular/core"],e):e(t.ngxCountDown={},t.ng.common,t.ng.core)}(this,function(t,e,i){"use strict";var n=function(){function t(){this.fns=[],this.commands=[],this.ing=!1}return t.prototype.start=function(){!0!==this.ing&&(this.ing=!0,this.nextTime=+new Date,this.process())},t.prototype.process=function(){for(var t=this;this.commands.length;)this.commands.shift()();var e,n,i,o,s=+new Date-this.nextTime,r=1+Math.floor(s/100);for(s=100-s%100,this.nextTime+=100*r,i=0,o=this.fns.length;i<o;i+=2)0===(e=this.fns[i+1])?this.fns[i](r):(e+=2*r-1,0<(n=Math.floor(e/20))&&this.fns[i](n),this.fns[i+1]=e%20+1);this.ing&&setTimeout(function(){t.process()},s)},t.prototype.add=function(t,e){var n=this;this.commands.push(function(){n.fns.push(t),n.fns.push(1e3===e?1:0),n.ing=0<n.fns.length})},t.prototype.remove=function(e){var n=this;this.commands.push(function(){var t=n.fns.indexOf(e);-1!==t&&n.fns.splice(t,2),n.ing=0<n.fns.length})},t.decorators=[{type:i.Injectable}],t}(),o=function(){function t(t,e,n){this.el=t,this.renderer=e,this.timer=n,this.frequency=1e3,this._notify={},this.hands=[],this.left=0,this.paused=!1,this.stoped=!1,this.start=new i.EventEmitter,this.finished=new i.EventEmitter,this.notify=new i.EventEmitter,this.event=new i.EventEmitter,this.timer.start()}return t.prototype.begin=function(){this.paused=!1,this.start.emit(),this.callEvent("start")},t.prototype.restart=function(){this.stoped||this.destroy(),this.init(),this.timer.start(),this.callEvent("restart")},t.prototype.stop=function(){this.stoped||(this.stoped=!0,this.destroy(),this.callEvent("stop"))},t.prototype.pause=function(){this.stoped||this.paused||(this.paused=!0,this.callEvent("pause"))},t.prototype.resume=function(){!this.stoped&&this.paused&&(this.paused=!1,this.callEvent("resume"))},t.prototype.mergeConfig=function(){this.config=Object.assign({demand:!1,leftTime:0,template:"$!h!时$!m!分$!s!秒",effect:"normal",varRegular:/\$\!([\-\w]+)\!/g,clock:["d",100,2,"h",24,2,"m",60,2,"s",60,2,"u",10,1]},this.config)},t.prototype.callEvent=function(t){this.event.emit({action:t,left:this.left})},t.prototype.init=function(){var i=this,o=i.el.nativeElement;i.paused=i.config.demand,i.stoped=!1;var t=o.innerHTML||i.config.template;i.config.varRegular.lastIndex=0,o.innerHTML=t.replace(i.config.varRegular,function(t,e){"u"!==e&&"s-ext"!==e||(i.frequency=100);var n="";return"s-ext"===e?(i.hands.push({type:"s"}),i.hands.push({type:"u"}),n=i.html("","s","handlet")+i.html(".","","digital")+i.html("","u","handlet")):i.hands.push({type:e}),i.html(n,e,"hand")});var s=i.config.clock;i.hands.forEach(function(t){var e,n=t.type,i=100;for(t.node=o.querySelector(".hand-"+n),e=s.length-3;-1<e&&n!==s[e];e-=3)i*=s[e+1];t.base=i,t.radix=s[e+1],t.bits=s[e+2]}),i.getLeft(),i.reflow(0,!0);var e=i.reflow;return i.reflow=function(t){return void 0===t&&(t=0),e.apply(i,[t])},i.config.notify&&i.config.notify.forEach(function(t){if(t<1)throw new Error("the notify config must be a positive integer.");t*=1e3,t-=t%i.frequency,i._notify[t]=!0}),i.timer.add(i.reflow,i.frequency),o.style.display="inline",i},t.prototype.destroy=function(){return this.timer.remove(this.reflow),this},t.prototype.reflow=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),e||!this.paused&&!this.stoped){var n=this;n.left=n.left-n.frequency*t,n.hands.forEach(function(t){t.lastValue=t.value,t.value=Math.floor(n.left/t.base)%t.radix}),n.repaint(),n._notify[n.left]&&(n.notify.emit(n.left),this.callEvent("notify")),n.left<1&&(n.finished.emit(0),this.stoped=!0,this.callEvent("finished"),this.destroy())}},t.prototype.repaint=function(){var e,n=this;n.config.repaint?n.config.repaint.apply(n):n.hands.forEach(function(t){t.lastValue!==t.value&&(e="",n.toDigitals(t.value,t.bits).forEach(function(t){e+=n.html(t.toString(),"","digital")}),t.node.innerHTML=e)})},t.prototype.getLeft=function(){var t=1e3*this.config.leftTime,e=this.config.stopTime;!t&&e&&(t=e-(new Date).getTime()),this.left=t-t%this.frequency},t.prototype.html=function(t,e,n){switch(n){case"hand":case"handlet":e=n+" hand-"+e;break;case"digital":e="."===t?n+" "+n+"-point "+e:n+" "+n+"-"+t+" "+e}return'<span class="'+e+'">'+t+"</span>"},t.prototype.toDigitals=function(t,e){t=t<0?0:t;for(var n=[];e--;)n[e]=t%10,t=Math.floor(t/10);return n},t.prototype.ngOnInit=function(){this.mergeConfig(),this.init(),this.config.demand||this.begin()},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.ngOnChanges=function(t){t.config.firstChange||(this.mergeConfig(),this.destroy().init())},t.decorators=[{type:i.Component,args:[{selector:"countdown",template:"<ng-content></ng-content>",styles:[":host { display: none; }"],host:{"[class.count-down]":"true"}}]}],t.ctorParameters=function(){return[{type:i.ElementRef},{type:i.Renderer},{type:n}]},t.propDecorators={config:[{type:i.Input}],start:[{type:i.Output}],finished:[{type:i.Output}],notify:[{type:i.Output}],event:[{type:i.Output}]},t}(),s=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule],providers:[n],declarations:[o],exports:[o]}]}],t}();t.CountdownComponent=o,t.CountdownModule=s,t.ɵa=n,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=countdown.umd.min.js.map
