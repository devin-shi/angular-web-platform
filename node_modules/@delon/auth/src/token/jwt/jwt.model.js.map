{"version":3,"file":"jwt.model.js","sourceRoot":"","sources":["../../../../../../packages/auth/token/jwt/jwt.model.ts"],"names":[],"mappings":";;;;AACA,OAAO,EAAE,eAAe,EAAE,MAAM,cAAc,CAAC;AAE/C,IAAA;;;IAQE,sBAAI,kCAAO;QAHX;;WAEG;;;;;QACH;YACE,qBAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACpC,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC;gBAAC,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;YAEjE,qBAAM,OAAO,GAAG,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;SAC5B;;;OAAA;IAED;;;;OAIG;;;;;;;IACH,iCAAS;;;;;;IAAT,UAAU,aAAyB;QAAzB,8BAAA,EAAA,iBAAyB;QACjC,qBAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YAAC,MAAM,CAAC,IAAI,CAAC;QAEhD,qBAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAEhC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,aAAa,GAAG,IAAI,CAAC,CAAC;KACxE;wBAhCH;IAiCC,CAAA;AA9BD,yBA8BC","sourcesContent":["import { ITokenModel } from '../interface';\r\nimport { urlBase64Decode } from './jwt.helper';\r\n\r\nexport class JWTTokenModel implements ITokenModel {\r\n  [key: string]: any;\r\n\r\n  token: string;\r\n\r\n  /**\r\n   * 获取载荷信息\r\n   */\r\n  get payload(): any {\r\n    const parts = this.token.split('.');\r\n    if (parts.length !== 3) throw new Error('JWT must have 3 parts');\r\n\r\n    const decoded = urlBase64Decode(parts[1]);\r\n    return JSON.parse(decoded);\r\n  }\r\n\r\n  /**\r\n   * 检查Token是否过期，`payload` 必须包含 `exp` 时有效\r\n   *\r\n   * @param offsetSeconds 偏移量\r\n   */\r\n  isExpired(offsetSeconds: number = 0): boolean {\r\n    const decoded = this.payload;\r\n    if (!decoded.hasOwnProperty('exp')) return null;\r\n\r\n    const date = new Date(0);\r\n    date.setUTCSeconds(decoded.exp);\r\n\r\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\r\n  }\r\n}\r\n"]}