{"version":3,"file":"title.service.js","sourceRoot":"","sources":["../../../../../../packages/theme/services/title/title.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Injectable,\n  Inject,\n  Optional,\n  Injector,\n  OnDestroy,\n} from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Title, DOCUMENT } from '@angular/platform-browser';\nimport { Subscription } from 'rxjs/Subscription';\n\nimport { MenuService } from '../menu/menu.service';\nimport { ALAIN_I18N_TOKEN, AlainI18NService } from '../i18n/i18n';\n\n/**\n * 设置标题\n * @see http://ng-alain.com/docs/service#TitleService\n */\n@Injectable()\nexport class TitleService implements OnDestroy {\n  private _prefix = '';\n  private _suffix = '';\n  private _separator = ' - ';\n  private _reverse = false;\n  private _default = 'Not Page Name';\n  private i18n$: Subscription;\n\n  constructor(\n    private injector: Injector,\n    private title: Title,\n    private menuSrv: MenuService,\n    @Optional()\n    @Inject(ALAIN_I18N_TOKEN)\n    private i18nSrv: AlainI18NService,\n    @Inject(DOCUMENT) private doc: any,\n  ) {\n    if (this.i18nSrv)\n      this.i18n$ = this.i18nSrv.change.subscribe(() => this.setTitle());\n  }\n\n  /** 设置分隔符 */\n  set separator(value: string) {\n    this._separator = value;\n  }\n\n  /** 设置前缀 */\n  set prefix(value: string) {\n    this._prefix = value;\n  }\n\n  /** 设置后缀 */\n  set suffix(value: string) {\n    this._suffix = value;\n  }\n\n  /** 设置是否反转 */\n  set reverse(value: boolean) {\n    this._reverse = value;\n  }\n\n  /** 设置默认标题名 */\n  set default(value: string) {\n    this._default = value;\n  }\n\n  private getByElement(): string {\n    const el =\n      this.doc.querySelector('.content__title h1') ||\n      this.doc.querySelector('pro-header h1.title');\n    if (el) {\n      return el.firstChild.textContent.trim();\n    }\n    return '';\n  }\n\n  private getByRoute(): string {\n    let next = this.injector.get(ActivatedRoute);\n    while (next.firstChild) next = next.firstChild;\n    const data = (next.snapshot && next.snapshot.data) || {};\n    if (data.titleI18n && this.i18nSrv)\n      data.title = this.i18nSrv.fanyi(data.titleI18n);\n    return data.title;\n  }\n\n  private getByMenu(): string {\n    const menus = this.menuSrv.getPathByUrl(this.injector.get(Router).url);\n    if (!menus || menus.length <= 0) return '';\n\n    const item = menus[menus.length - 1];\n    let title;\n    if (item.i18n && this.i18nSrv) title = this.i18nSrv.fanyi(item.i18n);\n    return title || item.text;\n  }\n\n  /**\n   * 设置标题，若不指定具体名称，则按以顺序获取：\n   * - 路由配置 `{ data: { title: 'page name' } }`\n   * - 根据当前 URL 解析菜单数据\n   * - 页面 `content__title` 中获取 `h1` 内容\n   * - 默认标题名\n   */\n  setTitle(title?: string | string[]) {\n    if (!title) {\n      title =\n        this.getByRoute() ||\n        this.getByMenu() ||\n        this.getByElement() ||\n        this._default;\n    }\n    if (title && !Array.isArray(title)) {\n      title = [title];\n    }\n\n    let newTitles = [];\n    if (this._prefix) {\n      newTitles.push(this._prefix);\n    }\n    newTitles.push(...(title as string[]));\n    if (this._suffix) {\n      newTitles.push(this._suffix);\n    }\n    if (this._reverse) {\n      newTitles = newTitles.reverse();\n    }\n    this.title.setTitle(newTitles.join(this._separator));\n  }\n\n  ngOnDestroy(): void {\n    if (this.i18n$) this.i18n$.unsubscribe();\n  }\n}\n"]}