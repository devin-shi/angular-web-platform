{"version":3,"file":"bar.component.js","sourceRoot":"","sources":["../../../../../../packages/abc/charts/bar/bar.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ViewChild,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  NgZone,\r\n  TemplateRef,\r\n  OnInit,\r\n  HostListener,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport { Observable } from 'rxjs/Observable';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { FromEventObservable } from 'rxjs/observable/FromEventObservable';\r\nimport {\r\n  coerceBooleanProperty,\r\n  coerceNumberProperty,\r\n} from '@angular/cdk/coercion';\r\n\r\n@Component({\r\n  selector: 'g2-bar',\r\n  template: `\r\n  <ng-container *ngIf=\"_title; else _titleTpl\"><h4>{{_title}}</h4></ng-container>\r\n  <div #container></div>`,\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  preserveWhitespaces: false,\r\n})\r\nexport class G2BarComponent implements OnDestroy, OnChanges, OnInit {\r\n  // region: fields\r\n  _title = '';\r\n  _titleTpl: TemplateRef<any>;\r\n  @Input()\r\n  set title(value: string | TemplateRef<any>) {\r\n    if (value instanceof TemplateRef) {\r\n      this._title = null;\r\n      this._titleTpl = value;\r\n    } else this._title = value;\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  @Input() color = 'rgba(24, 144, 255, 0.85)';\r\n\r\n  @HostBinding('style.height.px')\r\n  @Input()\r\n  get height() {\r\n    return this._height;\r\n  }\r\n  set height(value: any) {\r\n    this._height = coerceNumberProperty(value);\r\n  }\r\n  private _height = 0;\r\n\r\n  @Input() padding: number[];\r\n  @Input() data: Array<{ x: any; y: any; [key: string]: any }>;\r\n\r\n  @Input()\r\n  get autoLabel() {\r\n    return this._autoLabel;\r\n  }\r\n  set autoLabel(value: any) {\r\n    this._autoLabel = coerceBooleanProperty(value);\r\n  }\r\n  private _autoLabel = true;\r\n\r\n  // endregion\r\n\r\n  @HostBinding('class.g2-chart') private _cls = true;\r\n\r\n  @ViewChild('container') private node: ElementRef;\r\n\r\n  chart: any;\r\n\r\n  constructor(private el: ElementRef, private cd: ChangeDetectorRef) {\r\n    this.cd.detach();\r\n  }\r\n\r\n  install() {\r\n    if (!this.data || (this.data && this.data.length < 1)) return;\r\n    // this.uninstall();\r\n    this.node.nativeElement.innerHTML = '';\r\n\r\n    let padding = Object.assign([], this.padding);\r\n    if (padding.length <= 0)\r\n      padding = [32, 0, this.autoHideXLabels ? 8 : 32, 40];\r\n\r\n    const chart = new G2.Chart({\r\n      container: this.node.nativeElement,\r\n      forceFit: true,\r\n      height: +this.height - 22,\r\n      legend: null,\r\n      padding: padding,\r\n    });\r\n\r\n    chart.axis('x', !this.autoHideXLabels);\r\n    chart.axis('y', {\r\n      title: false,\r\n      line: false,\r\n      tickLine: false,\r\n    });\r\n\r\n    chart.source(this.data, {\r\n      x: {\r\n        type: 'cat',\r\n      },\r\n      y: {\r\n        min: 0,\r\n      },\r\n    });\r\n\r\n    chart.tooltip({\r\n      showTitle: false,\r\n    });\r\n    chart\r\n      .interval()\r\n      .position('x*y')\r\n      .color(this.color)\r\n      .tooltip('x*y', (x, y) => {\r\n        return {\r\n          name: x,\r\n          value: y,\r\n        };\r\n      });\r\n    chart.render();\r\n    setTimeout(() => {\r\n      chart.forceFit();\r\n      chart.repaint();\r\n    }, 30);\r\n    this.chart = chart;\r\n  }\r\n\r\n  uninstall() {\r\n    if (this.chart) {\r\n      this.chart.destroy();\r\n      this.chart = null;\r\n    }\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.installResizeEvent();\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    this.resize();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.uninstallResizeEvent();\r\n    this.uninstall();\r\n  }\r\n\r\n  // region: resize\r\n\r\n  private autoHideXLabels = false;\r\n  private scroll$: Subscription = null;\r\n  private installResizeEvent() {\r\n    if (!this.autoLabel || this.scroll$) return;\r\n\r\n    this.scroll$ = <any>FromEventObservable.create(window, 'resize')\r\n      .pipe(debounceTime(200))\r\n      .subscribe(() => this.resize());\r\n  }\r\n\r\n  private uninstallResizeEvent() {\r\n    if (this.scroll$) this.scroll$.unsubscribe();\r\n  }\r\n\r\n  resize() {\r\n    const canvasWidth = this.el.nativeElement.clientWidth;\r\n    const minWidth = this.data.length * 30;\r\n\r\n    if (canvasWidth <= minWidth) {\r\n      if (!this.autoHideXLabels) {\r\n        this.autoHideXLabels = true;\r\n        this.install();\r\n        return;\r\n      }\r\n    } else if (this.autoHideXLabels) {\r\n      this.autoHideXLabels = false;\r\n      this.install();\r\n      return;\r\n    }\r\n    if (!this.chart) this.install();\r\n  }\r\n\r\n  // endregion\r\n}\r\n"]}