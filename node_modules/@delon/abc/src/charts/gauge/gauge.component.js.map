{"version":3,"file":"gauge.component.js","sourceRoot":"","sources":["../../../../../../packages/abc/charts/gauge/gauge.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ViewChild,\r\n  ElementRef,\r\n  OnInit,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  NgZone,\r\n  TemplateRef,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  SimpleChange,\r\n} from '@angular/core';\r\nimport { coerceNumberProperty } from '@angular/cdk/coercion';\r\n\r\n@Component({\r\n  selector: 'g2-gauge',\r\n  template: `<div #container></div>`,\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class G2GaugeComponent implements OnInit, OnDestroy, OnChanges {\r\n  // region: fields\r\n\r\n  @Input() title: string;\r\n  @Input()\r\n  get height() {\r\n    return this._height;\r\n  }\r\n  set height(value: any) {\r\n    this._height = coerceNumberProperty(value);\r\n  }\r\n  private _height;\r\n  @Input() color = '#2F9CFF';\r\n  @Input() bgColor = '#F0F2F5';\r\n  @Input() format: Function;\r\n\r\n  @Input()\r\n  get percent() {\r\n    return this._percent;\r\n  }\r\n  set percent(value: any) {\r\n    this._percent = coerceNumberProperty(value);\r\n  }\r\n  private _percent: number;\r\n\r\n  // endregion\r\n\r\n  @ViewChild('container') node: ElementRef;\r\n\r\n  chart: any;\r\n  initFlag = false;\r\n\r\n  constructor(private cd: ChangeDetectorRef) {\r\n    this.cd.detach();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initFlag = true;\r\n    this.install();\r\n  }\r\n\r\n  private createData() {\r\n    return [{ name: this.title, value: +this.percent }];\r\n  }\r\n\r\n  private draw() {\r\n    if (!this.chart) return;\r\n    this.chart.guide().clear();\r\n    const data = this.createData();\r\n    // 绘制仪表盘背景\r\n    this.chart.guide().arc({\r\n      zIndex: 0,\r\n      top: false,\r\n      start: [0, 0.95],\r\n      end: [100, 0.95],\r\n      style: {\r\n        // 底灰色\r\n        stroke: this.bgColor,\r\n        lineWidth: 12,\r\n      },\r\n    });\r\n    // 绘制指标\r\n    this.chart.guide().arc({\r\n      zIndex: 1,\r\n      start: [0, 0.95],\r\n      end: [data[0].value, 0.95],\r\n      style: {\r\n        stroke: this.color,\r\n        lineWidth: 12,\r\n      },\r\n    });\r\n    this.chart.changeData(data);\r\n  }\r\n\r\n  install() {\r\n    this.node.nativeElement.innerHTML = '';\r\n    const Shape = G2.Shape;\r\n    // 自定义Shape 部分\r\n    Shape.registerShape('point', 'pointer', {\r\n      drawShape(cfg, group) {\r\n        let point = cfg.points[0]; // 获取第一个标记点\r\n        point = this.parsePoint(point);\r\n        const center = this.parsePoint({\r\n          // 获取极坐标系下画布中心点\r\n          x: 0,\r\n          y: 0,\r\n        });\r\n        // 绘制指针\r\n        group.addShape('line', {\r\n          attrs: {\r\n            x1: center.x,\r\n            y1: center.y,\r\n            x2: point.x,\r\n            y2: point.y,\r\n            stroke: cfg.color,\r\n            lineWidth: 2,\r\n            lineCap: 'round',\r\n          },\r\n        });\r\n\r\n        const { origin } = cfg;\r\n        group.addShape('text', {\r\n          attrs: {\r\n            x: center.x,\r\n            y: center.y + 80,\r\n            text: `${origin._origin.value}%`,\r\n            textAlign: 'center',\r\n            fontSize: 24,\r\n            fill: 'rgba(0, 0, 0, 0.85)',\r\n          },\r\n        });\r\n        return group.addShape('circle', {\r\n          attrs: {\r\n            x: center.x,\r\n            y: center.y,\r\n            r: 9.75,\r\n            stroke: cfg.color,\r\n            lineWidth: 2,\r\n            fill: '#fff',\r\n          },\r\n        });\r\n      },\r\n    });\r\n\r\n    const data = this.createData();\r\n    const chart = new G2.Chart({\r\n      container: this.node.nativeElement,\r\n      forceFit: true,\r\n      height: this.height,\r\n      padding: [10, 10, 30, 10],\r\n    });\r\n    chart.source(data);\r\n\r\n    chart.coord('polar', {\r\n      startAngle: -1.2 * Math.PI,\r\n      endAngle: 0.2 * Math.PI,\r\n    });\r\n    chart.scale('value', {\r\n      min: 0,\r\n      max: 100,\r\n      nice: true,\r\n      tickCount: 6,\r\n    });\r\n\r\n    chart.axis('1', false);\r\n    // 刻度值\r\n    chart.axis('value', {\r\n      zIndex: 2,\r\n      line: null,\r\n      label: {\r\n        offset: -12,\r\n        formatter: this.format,\r\n      },\r\n      tickLine: null,\r\n      grid: null,\r\n    });\r\n    chart.legend(false);\r\n    chart\r\n      .point({\r\n        generatePoints: true,\r\n      })\r\n      .position('value*1')\r\n      .shape('pointer')\r\n      .color(this.color)\r\n      .active(false);\r\n\r\n    this.chart = chart;\r\n    setTimeout(() => {\r\n      chart.forceFit();\r\n      chart.repaint();\r\n    });\r\n    this.draw();\r\n  }\r\n\r\n  uninstall() {\r\n    if (this.chart) this.chart.destroy();\r\n  }\r\n\r\n  ngOnChanges(\r\n    changes: { [P in keyof this]?: SimpleChange } & SimpleChanges,\r\n  ): void {\r\n    if (this.initFlag) this.draw();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.uninstall();\r\n  }\r\n}\r\n"]}