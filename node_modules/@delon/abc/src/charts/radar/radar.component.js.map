{"version":3,"file":"radar.component.js","sourceRoot":"","sources":["../../../../../../packages/abc/charts/radar/radar.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ViewChild,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  NgZone,\r\n  TemplateRef,\r\n  OnInit,\r\n  HostListener,\r\n  Output,\r\n  EventEmitter,\r\n  ContentChild,\r\n  SimpleChange,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n} from '@angular/core';\r\nimport {\r\n  coerceNumberProperty,\r\n  coerceBooleanProperty,\r\n} from '@angular/cdk/coercion';\r\n\r\n@Component({\r\n  selector: 'g2-radar',\r\n  template: `\r\n  <h4 *ngIf=\"_title; else _titleTpl\">{{ _title }}</h4>\r\n  <div #container></div>\r\n  <div nz-row class=\"legend\" *ngIf=\"hasLegend\">\r\n    <div nz-col [nzSpan]=\"24 / legendData.length\" *ngFor=\"let i of legendData; let idx = index\" (click)=\"handleLegendClick(idx)\">\r\n      <div class=\"legend-item\">\r\n        <p>\r\n          <i class=\"dot\" [ngStyle]=\"{'background-color': !i.checked ? '#aaa' : i.color}\"></i>\r\n          <span>{{i.name}}</span>\r\n        </p>\r\n        <h6>{{i.value}}</h6>\r\n      </div>\r\n    </div>\r\n  </div>`,\r\n  host: { '[class.ad-radar]': 'true' },\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  preserveWhitespaces: false,\r\n})\r\nexport class G2RadarComponent implements OnDestroy, OnChanges, OnInit {\r\n  // region: fields\r\n\r\n  _title = '';\r\n  _titleTpl: TemplateRef<any>;\r\n  @Input()\r\n  set title(value: string | TemplateRef<any>) {\r\n    if (value instanceof TemplateRef) {\r\n      this._title = null;\r\n      this._titleTpl = value;\r\n    } else this._title = value;\r\n  }\r\n\r\n  @HostBinding('style.height.px')\r\n  @Input()\r\n  get height() {\r\n    return this._height;\r\n  }\r\n  set height(value: any) {\r\n    this._height = coerceNumberProperty(value);\r\n  }\r\n  private _height = 0;\r\n\r\n  @Input() padding: number[] = [44, 30, 16, 30];\r\n\r\n  @Input()\r\n  get hasLegend() {\r\n    return this._hasLegend;\r\n  }\r\n  set hasLegend(value: any) {\r\n    this._hasLegend = coerceBooleanProperty(value);\r\n  }\r\n  private _hasLegend = true;\r\n\r\n  @Input()\r\n  get tickCount() {\r\n    return this._tickCount;\r\n  }\r\n  set tickCount(value: any) {\r\n    this._tickCount = coerceNumberProperty(value);\r\n  }\r\n  private _tickCount = 4;\r\n\r\n  @Input()\r\n  data: Array<{\r\n    name: string;\r\n    label: string;\r\n    value: number;\r\n    [key: string]: any;\r\n  }> = [];\r\n\r\n  // endregion\r\n\r\n  @ViewChild('container') node: ElementRef;\r\n\r\n  chart: any;\r\n  initFlag = false;\r\n  legendData: any[] = [];\r\n\r\n  constructor(private el: ElementRef, private cd: ChangeDetectorRef) {}\r\n\r\n  handleLegendClick(i: number) {\r\n    this.legendData[i].checked = !this.legendData[i].checked;\r\n\r\n    if (this.chart) {\r\n      // const filterItem = this.legendData.filter(l => l.checked).map(l => l.name);\r\n      this.chart.filter(\r\n        'name',\r\n        (val: any) => this.legendData.find(w => w.name === val).checked,\r\n      );\r\n      this.chart.repaint();\r\n    }\r\n  }\r\n\r\n  install() {\r\n    if (!this.data || (this.data && this.data.length < 1)) return;\r\n\r\n    this.node.nativeElement.innerHTML = '';\r\n\r\n    const colors = [\r\n      '#1890FF',\r\n      '#FACC14',\r\n      '#2FC25B',\r\n      '#8543E0',\r\n      '#F04864',\r\n      '#13C2C2',\r\n      '#fa8c16',\r\n      '#a0d911',\r\n    ];\r\n\r\n    const chart = new G2.Chart({\r\n      container: this.node.nativeElement,\r\n      forceFit: true,\r\n      height: +this.height - (this.hasLegend ? 80 : 22),\r\n      padding: this.padding,\r\n    });\r\n    chart.source(this.data, {\r\n      value: {\r\n        min: 0,\r\n        tickCount: this.tickCount,\r\n      },\r\n    });\r\n\r\n    chart.coord('polar');\r\n    chart.legend(false);\r\n\r\n    chart.axis('label', {\r\n      line: null,\r\n      labelOffset: 8,\r\n      labels: {\r\n        label: {\r\n          fill: 'rgba(0, 0, 0, .65)',\r\n        },\r\n      },\r\n      grid: {\r\n        line: {\r\n          stroke: '#e9e9e9',\r\n          lineWidth: 1,\r\n          lineDash: [0, 0],\r\n        },\r\n      },\r\n    });\r\n\r\n    chart.axis('value', {\r\n      grid: {\r\n        type: 'polygon',\r\n        line: {\r\n          stroke: '#e9e9e9',\r\n          lineWidth: 1,\r\n          lineDash: [0, 0],\r\n        },\r\n      },\r\n      labels: {\r\n        label: {\r\n          fill: 'rgba(0, 0, 0, .65)',\r\n        },\r\n      },\r\n    });\r\n\r\n    chart\r\n      .line()\r\n      .position('label*value')\r\n      .color('name', colors);\r\n    chart\r\n      .point()\r\n      .position('label*value')\r\n      .color('name', colors)\r\n      .shape('circle')\r\n      .size(3);\r\n\r\n    chart.render();\r\n    setTimeout(() => {\r\n      chart.forceFit();\r\n      chart.repaint();\r\n    });\r\n\r\n    this.chart = chart;\r\n\r\n    if (this.hasLegend) {\r\n      this.legendData = chart\r\n        .getAllGeoms()[0]\r\n        ._attrs.dataArray.map((item: any) => {\r\n          const origin = item[0]._origin;\r\n          const result = {\r\n            name: origin.name,\r\n            color: item[0].color,\r\n            checked: true,\r\n            value: item.reduce((p, n) => p + n._origin.value, 0),\r\n          };\r\n\r\n          return result;\r\n        });\r\n      this.cd.detectChanges();\r\n    }\r\n  }\r\n\r\n  uninstall() {\r\n    if (this.chart) {\r\n      this.chart.destroy();\r\n      this.chart = null;\r\n    }\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initFlag = true;\r\n    this.install();\r\n  }\r\n\r\n  ngOnChanges(\r\n    changes: { [P in keyof this]?: SimpleChange } & SimpleChanges,\r\n  ): void {\r\n    if (this.initFlag) this.install();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.uninstall();\r\n  }\r\n}\r\n"]}