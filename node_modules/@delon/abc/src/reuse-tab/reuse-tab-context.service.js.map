{"version":3,"file":"reuse-tab-context.service.js","sourceRoot":"","sources":["../../../../../packages/abc/reuse-tab/reuse-tab-context.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport {\r\n  Overlay,\r\n  OverlayRef,\r\n  ScrollStrategyOptions,\r\n} from '@angular/cdk/overlay';\r\nimport { ComponentPortal } from '@angular/cdk/portal';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport { Subject } from 'rxjs/Subject';\r\n\r\nimport {\r\n  ReuseContextEvent,\r\n  ReuseContextI18n,\r\n  ReuseContextCloseEvent,\r\n} from './interface';\r\nimport { ReuseTabContextMenuComponent } from './reuse-tab-context-menu.component';\r\n\r\n@Injectable()\r\nexport class ReuseTabContextService {\r\n  private ref: OverlayRef;\r\n  i18n: ReuseContextI18n;\r\n\r\n  show: Subject<ReuseContextEvent> = new Subject<ReuseContextEvent>();\r\n  close: Subject<ReuseContextCloseEvent> = new Subject<\r\n    ReuseContextCloseEvent\r\n  >();\r\n\r\n  constructor(private overlay: Overlay) {}\r\n\r\n  remove() {\r\n    if (!this.ref) return;\r\n    this.ref.detach();\r\n    this.ref.dispose();\r\n    this.ref = null;\r\n  }\r\n\r\n  open(context: ReuseContextEvent) {\r\n    this.remove();\r\n    const { event, item } = context;\r\n    const fakeElement = {\r\n      getBoundingClientRect: (): ClientRect => ({\r\n        bottom: event.clientY,\r\n        height: 0,\r\n        left: event.clientX,\r\n        right: event.clientX,\r\n        top: event.clientY,\r\n        width: 0,\r\n      }),\r\n    };\r\n    const positionStrategy = this.overlay\r\n      .position()\r\n      .connectedTo(\r\n        { nativeElement: fakeElement },\r\n        { originX: 'start', originY: 'bottom' },\r\n        { overlayX: 'start', overlayY: 'top' },\r\n      )\r\n      .withFallbackPosition(\r\n        { originX: 'start', originY: 'top' },\r\n        { overlayX: 'start', overlayY: 'bottom' },\r\n      )\r\n      .withFallbackPosition(\r\n        { originX: 'end', originY: 'top' },\r\n        { overlayX: 'start', overlayY: 'top' },\r\n      )\r\n      .withFallbackPosition(\r\n        { originX: 'start', originY: 'top' },\r\n        { overlayX: 'end', overlayY: 'top' },\r\n      )\r\n      .withFallbackPosition(\r\n        { originX: 'end', originY: 'center' },\r\n        { overlayX: 'start', overlayY: 'center' },\r\n      )\r\n      .withFallbackPosition(\r\n        { originX: 'start', originY: 'center' },\r\n        { overlayX: 'end', overlayY: 'center' },\r\n      );\r\n    this.ref = this.overlay.create({\r\n      positionStrategy,\r\n      panelClass: 'reuse-tab-cm',\r\n      scrollStrategy: this.overlay.scrollStrategies.close(),\r\n    });\r\n    const comp = this.ref.attach(\r\n      new ComponentPortal(ReuseTabContextMenuComponent),\r\n    );\r\n    const instance = comp.instance;\r\n    instance.i18n = this.i18n;\r\n    instance.item = { ...item };\r\n    instance.event = event;\r\n\r\n    const sub$ = new Subscription();\r\n    sub$.add(\r\n      instance.close.subscribe((res: ReuseContextCloseEvent) => {\r\n        this.close.next(res);\r\n        this.remove();\r\n      }),\r\n    );\r\n    comp.onDestroy(() => sub$.unsubscribe());\r\n  }\r\n}\r\n"]}