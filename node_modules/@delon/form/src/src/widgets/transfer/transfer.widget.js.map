{"version":3,"file":"transfer.widget.js","sourceRoot":"","sources":["../../../../../../../packages/form/src/widgets/transfer/transfer.widget.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Observable } from 'rxjs/Observable';\nimport { of } from 'rxjs/observable/of';\nimport { ControlWidget } from '../../widget';\nimport { getData } from '../../utils';\nimport { SFSchemaEnum } from '../../schema';\n\n@Component({\n  selector: 'sf-transfer',\n  template: `\n  <sf-item-wrap [id]=\"id\" [schema]=\"schema\" [ui]=\"ui\" [showError]=\"showError\" [error]=\"error\" [showTitle]=\"schema.title\">\n\n    <nz-transfer\n      [nzDataSource]=\"list\"\n      [nzTitles]=\"i.titles\"\n      [nzOperations]=\"i.operations\"\n      [nzListStyle]=\"ui.listStyle\"\n      [nzItemUnit]=\"i.itemUnit\"\n      [nzItemsUnit]=\"i.itemsUnit\"\n      [nzShowSearch]=\"ui.showSearch\"\n      [nzFilterOption]=\"ui.filterOption\"\n      [nzSearchPlaceholder]=\"ui.searchPlaceholder\"\n      [nzNotFoundContent]=\"ui.notFoundContent\"\n      [nzCanMove]=\"_canMove\"\n      (nzChange)=\"_change($event)\"\n      (nzSearchChange)=\"_searchChange($event)\"\n      (nzSelectChange)=\"_selectChange($event)\">\n    </nz-transfer>\n\n  </sf-item-wrap>\n  `,\n  preserveWhitespaces: false,\n})\nexport class TransferWidget extends ControlWidget implements OnInit {\n  list: any[] = [];\n  i: any;\n  private _data: any[] = [];\n\n  ngOnInit(): void {\n    this.i = {\n      titles: this.ui.titles || ['', ''],\n      operations: this.ui.operations || ['', ''],\n      itemUnit: this.ui.itemUnit || '项',\n      itemsUnit: this.ui.itemsUnit || '项',\n    };\n  }\n\n  reset(value: any) {\n    getData(this.schema, this.ui, null).subscribe(list => {\n      let formData = this.formProperty.formData;\n      if (!Array.isArray(formData)) formData = [formData];\n      list.forEach((item: SFSchemaEnum) => {\n        if (~(formData as any[]).indexOf(item.value)) item.direction = 'right';\n      });\n      this.list = list;\n      this._data = list.filter(w => w.direction === 'right');\n      this.notify();\n      this.detectChanges();\n    });\n  }\n\n  private notify() {\n    this.formProperty.setValue(this._data.map(i => i.value), false);\n  }\n\n  _canMove = (arg: any): Observable<any[]> => {\n    return this.ui.canMove ? this.ui.canMove(arg) : of(arg.list);\n  };\n\n  _change(options: any) {\n    if (options.to === 'right') {\n      this._data = this._data.concat(...options.list);\n    } else {\n      this._data = this._data.filter(w => options.list.indexOf(w) === -1);\n    }\n    if (this.ui.change) this.ui.change(options);\n    this.notify();\n  }\n\n  _searchChange(options: any) {\n    if (this.ui.searchChange) this.ui.searchChange(options);\n  }\n\n  _selectChange(options: any) {\n    if (this.ui.selectChange) this.ui.selectChange(options);\n    this.cd.detectChanges();\n  }\n}\n"]}