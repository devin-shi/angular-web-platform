{"version":3,"file":"object.property.js","sourceRoot":"","sources":["../../../../../../packages/form/src/model/object.property.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropertyGroup } from './form.property';\r\nimport { FormPropertyFactory } from './form.property.factory';\r\nimport { SchemaValidatorFactory } from '../validator.factory';\r\nimport { DelonFormConfig } from '../config';\r\nimport { ErrorData } from '../errors';\r\nimport { SFUISchema, SFUISchemaItem } from '../schema/ui';\r\nimport { orderProperties } from '../utils';\r\n\r\nexport class ObjectProperty extends PropertyGroup {\r\n  private _propertiesId: string[] = [];\r\n\r\n  get propertiesId() {\r\n    return this._propertiesId;\r\n  }\r\n\r\n  constructor(\r\n    private formPropertyFactory: FormPropertyFactory,\r\n    schemaValidatorFactory: SchemaValidatorFactory,\r\n    schema: any,\r\n    ui: SFUISchema | SFUISchemaItem,\r\n    formData: {},\r\n    parent: PropertyGroup,\r\n    path: string,\r\n    options: DelonFormConfig,\r\n  ) {\r\n    super(schemaValidatorFactory, schema, ui, formData, parent, path, options);\r\n    this.createProperties();\r\n  }\r\n\r\n  private createProperties() {\r\n    this.properties = {};\r\n    this._propertiesId = [];\r\n    let orderedProperties: string[];\r\n    try {\r\n      orderedProperties = orderProperties(\r\n        Object.keys(this.schema.properties),\r\n        this.ui.order,\r\n      );\r\n    } catch (e) {\r\n      console.error(\r\n        `Invalid ${this.schema.title || 'root'} object field configuration:`,\r\n        e,\r\n      );\r\n    }\r\n    orderedProperties.forEach(propertyId => {\r\n      if (this.schema.properties.hasOwnProperty(propertyId)) {\r\n        const propertySchema = this.schema.properties[propertyId];\r\n        this.properties[propertyId] = this.formPropertyFactory.createProperty(\r\n          this.schema.properties[propertyId],\r\n          this.ui['$' + propertyId],\r\n          (this.formData || {})[propertyId],\r\n          this,\r\n          propertyId,\r\n        );\r\n        this._propertiesId.push(propertyId);\r\n      }\r\n    });\r\n  }\r\n\r\n  setValue(value: any, onlySelf: boolean) {\r\n    for (const propertyId in value) {\r\n      if (value.hasOwnProperty(propertyId)) {\r\n        this.properties[propertyId].setValue(value[propertyId], true);\r\n      }\r\n    }\r\n    this.updateValueAndValidity(onlySelf, true);\r\n  }\r\n  resetValue(value: any, onlySelf: boolean) {\r\n    value = value || this.schema.default || {};\r\n    for (const propertyId in this.schema.properties) {\r\n      if (this.schema.properties.hasOwnProperty(propertyId)) {\r\n        this.properties[propertyId].resetValue(value[propertyId], true);\r\n      }\r\n    }\r\n    this.updateValueAndValidity(onlySelf, true);\r\n  }\r\n  _hasValue(): boolean {\r\n    return this.value != null && !!Object.keys(this.value).length;\r\n  }\r\n  _updateValue() {\r\n    const value: any = {};\r\n    this.forEachChild((property: any, propertyId: string) => {\r\n      if (property.visible && property._hasValue()) {\r\n        value[propertyId] = property.value;\r\n      }\r\n    });\r\n    this._value = value;\r\n  }\r\n}\r\n"]}