/**
 * @license ng-alain(cipchk@qq.com) v1.0.0-beta.10
 * (c) 2018 Cipchk http://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("@angular/router"),require("rxjs/Observable"),require("rxjs/observable/of"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/BehaviorSubject","@angular/router","rxjs/Observable","rxjs/observable/of","rxjs/operators","@angular/common"],t):t((e.delon=e.delon||{},e.delon.acl={}),e.ng.core,e.Rx,e.ng.router,e.Rx,e.Rx.Observable,e.Rx.Observable.prototype,e.ng.common)}(this,function(e,t,r,i,n,o,a,s){"use strict";var l=function(){function e(){this.roles=[],this.abilities=[],this.full=!1,this.aclChange=new r.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"change",{get:function(){return this.aclChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return{full:this.full,roles:this.roles,abilities:this.abilities}},enumerable:!0,configurable:!0}),e.prototype.parseACLType=function(e){return"string"==typeof e||Array.isArray(e)?Array.isArray(e)?{role:e}:{role:[e]}:e},e.prototype.set=function(e){this.abilities=[],this.roles=[],this.add(e),this.aclChange.next(e)},e.prototype.setFull=function(e){this.full=e,this.aclChange.next(e)},e.prototype.setAbility=function(e){this.set({ability:e})},e.prototype.setRole=function(e){this.set({role:e})},e.prototype.add=function(e){var t,r;e.role&&0<e.role.length&&(t=this.roles).push.apply(t,e.role),e.ability&&0<e.ability.length&&(r=this.abilities).push.apply(r,e.ability)},e.prototype.attachRole=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.roles.includes(i)||this.roles.push(i)}this.aclChange.next(this.data)},e.prototype.attachAbility=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.abilities.includes(i)||this.abilities.push(i)}this.aclChange.next(this.data)},e.prototype.removeRole=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.roles.indexOf(i);-1!==n&&this.roles.splice(n,1)}this.aclChange.next(this.data)},e.prototype.removeAbility=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.abilities.indexOf(i);-1!==n&&this.abilities.splice(n,1)}this.aclChange.next(this.data)},e.prototype.can=function(e){var t=this;if(!0===this.full||!e)return!0;var r={};return(r="number"==typeof e?{ability:[e]}:Array.isArray(e)&&0<e.length&&"number"==typeof e[0]?{ability:e}:this.parseACLType(e)).role?"allOf"===r.mode?r.role.every(function(e){return t.roles.includes(e)}):r.role.some(function(e){return t.roles.includes(e)}):!!r.ability&&("allOf"===r.mode?r.ability.every(function(e){return t.abilities.includes(e)}):r.ability.some(function(e){return t.abilities.includes(e)}))},e.prototype.parseAbility=function(e){return("number"==typeof e||"string"==typeof e||Array.isArray(e))&&(e={ability:Array.isArray(e)?e:[e]}),delete e.role,e},e.prototype.canAbility=function(e){return this.can(this.parseAbility(e))},e.decorators=[{type:t.Injectable}],e}(),u=function(){function e(e,t,r){var i=this;this.el=e,this.renderer=t,this.srv=r,this.change$=this.srv.change.subscribe(function(){return i.set(i._value)})}return Object.defineProperty(e.prototype,"acl",{set:function(e){this.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ability",{set:function(e){this.set(this.srv.parseAbility(e))},enumerable:!0,configurable:!0}),e.prototype.set=function(e){var t="acl__hide",r=this.el.nativeElement;this.srv.can(e)?this.renderer.removeClass(r,t):this.renderer.addClass(r,t),this._value=e},e.prototype.ngOnDestroy=function(){this.change$.unsubscribe()},e.decorators=[{type:t.Directive,args:[{selector:"[acl]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:l}]},e.propDecorators={acl:[{type:t.Input,args:["acl"]}],ability:[{type:t.Input,args:["acl-ability"]}]},e}(),c=function(){function e(){this.guard_url="/403"}return e.decorators=[{type:t.Injectable}],e}(),p=function(){function e(e,t,r){this.srv=e,this.router=t,this.options=r}return e.prototype.process=function(e){var t=this;return(e&&e instanceof n.Observable?e:o.of(null!=e?e:null)).pipe(a.map(function(e){return t.srv.can(e)}),a.tap(function(e){e||t.router.navigateByUrl(t.options.guard_url)}))},e.prototype.canLoad=function(e){return this.process(e.data&&e.data.guard||null)},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.canActivate=function(e,t){return this.process(e.data&&e.data.guard||null)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:l},{type:i.Router},{type:c}]},e}(),h=[l,p],f=[u],y=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[c].concat(h)}},e.decorators=[{type:t.NgModule,args:[{imports:[s.CommonModule],declarations:f.slice(),exports:f.slice()}]}],e}();e.ACLService=l,e.ACLDirective=u,e.DelonACLConfig=c,e.ACLGuard=p,e.DelonACLModule=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=acl.umd.min.js.map
