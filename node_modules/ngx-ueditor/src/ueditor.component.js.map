{"version":3,"file":"ueditor.component.js","sourceRoot":"","sources":["../../.ng_build/src/ueditor.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, forwardRef, ViewChild, ElementRef, OnDestroy, EventEmitter, Output, ViewEncapsulation, OnInit, Optional, ChangeDetectionStrategy, ChangeDetectorRef, AfterViewInit, OnChanges, SimpleChanges } from '@angular/core';\r\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\r\nimport { Router, ActivationEnd } from '@angular/router';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport { debounceTime, filter } from 'rxjs/operators';\r\n\r\nimport { ScriptService } from './script.service';\r\nimport { UEditorConfig } from './ueditor.config';\r\n\r\ndeclare const window: any;\r\ndeclare const UE: any;\r\n\r\nexport type EventTypes = 'destroy' | 'reset' | 'focus' | 'langReady' | 'beforeExecCommand' | 'afterExecCommand' | 'firstBeforeExecCommand' | 'beforeGetContent' | 'afterGetContent' | 'getAllHtml' | 'beforeSetContent' | 'afterSetContent' | 'selectionchange' | 'beforeSelectionChange' | 'afterSelectionChange';\r\n\r\n@Component({\r\n    selector: 'ueditor',\r\n    template: `\r\n    <textarea #host id=\"{{id}}\" class=\"ueditor-textarea\"></textarea>\r\n    <div class=\"loading\" *ngIf=\"loading\" [innerHTML]=\"loadingTip\"></div>\r\n    `,\r\n    encapsulation: ViewEncapsulation.Emulated,\r\n    styles: [ `.ueditor-textarea{display:none;}` ],\r\n    providers: [{\r\n        provide: NG_VALUE_ACCESSOR,\r\n        useExisting: forwardRef(() => UEditorComponent),\r\n        multi: true\r\n    }],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class UEditorComponent implements OnInit, AfterViewInit, OnChanges, OnDestroy, ControlValueAccessor {\r\n    private instance: any;\r\n    private value: string;\r\n    private inited = false;\r\n    private path: string;\r\n    private events: any = {};\r\n    private route$: Subscription;\r\n\r\n    loading = true;\r\n    id = `_ueditor-${Math.random().toString(36).substring(2)}`;\r\n\r\n    @Input() config: any;\r\n    @Input() loadingTip = '加载中...';\r\n    @ViewChild('host') host: ElementRef;\r\n\r\n    @Output() onPreReady = new EventEmitter<UEditorComponent>();\r\n    @Output() onReady = new EventEmitter<UEditorComponent>();\r\n    @Output() onDestroy = new EventEmitter();\r\n    @Output() onContentChange = new EventEmitter();\r\n\r\n    constructor(private el: ElementRef,\r\n                private ss: ScriptService,\r\n                @Optional() private router: Router,\r\n                private defConfig: UEditorConfig,\r\n                private cd: ChangeDetectorRef\r\n            ) {}\r\n\r\n    ngOnInit() {\r\n        this.inited = true;\r\n        this.path = this.defConfig && this.defConfig.path;\r\n        if (!this.path) this.path = './assets/ueditor/';\r\n\r\n        this.route$ = <any>this.router.events.pipe(\r\n            filter(e => e instanceof ActivationEnd),\r\n            debounceTime(100),\r\n            filter(e => !!document.querySelector('#' + this.id))\r\n        ).subscribe(res => {\r\n            this.destroy();\r\n            this.init();\r\n        });\r\n    }\r\n\r\n    ngAfterViewInit(): void {\r\n        // 已经存在对象无须进入懒加载模式\r\n        if (window.UE) {\r\n            this.init();\r\n            return;\r\n        }\r\n\r\n        this.ss.load(this.path, true).getChangeEmitter().subscribe(res => {\r\n            this.init();\r\n        });\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if (this.inited && changes.config) {\r\n            this.destroy();\r\n            this.init();\r\n        }\r\n    }\r\n\r\n    private init(options?: any) {\r\n        if (!window.UE)\r\n            throw new Error('uedito js文件加载失败');\r\n\r\n        if (this.instance) return;\r\n\r\n        // registrer hook\r\n        if (this.defConfig && this.defConfig.hook) {\r\n            if (!this.defConfig._hook_finished) {\r\n                this.defConfig._hook_finished = true;\r\n                this.defConfig.hook(UE);\r\n            }\r\n        }\r\n\r\n        this.onPreReady.emit(this);\r\n\r\n        const opt = Object.assign({\r\n            UEDITOR_HOME_URL: this.path\r\n        }, this.defConfig && this.defConfig.options, this.config, options);\r\n\r\n        const ueditor = UE.getEditor(this.id, opt);\r\n        ueditor.ready(() => {\r\n            this.loading = false;\r\n            this.instance = ueditor;\r\n            this.value && this.instance.setContent(this.value);\r\n            this.onReady.emit(this);\r\n            this.cd.markForCheck();\r\n        });\r\n\r\n        ueditor.addListener('contentChange', () => {\r\n            this.value = ueditor.getContent();\r\n\r\n            this.onChange(this.value);\r\n            this.onTouched(this.value);\r\n\r\n            this.onContentChange.emit(this.value);\r\n        });\r\n    }\r\n\r\n    private destroy() {\r\n        if (this.instance) {\r\n            for (const ki of this.events) {\r\n                this.instance.removeListener(ki, this.events[ki]);\r\n            }\r\n            this.instance.removeListener('ready');\r\n            this.instance.removeListener('contentChange');\r\n            this.instance.destroy();\r\n            this.instance = null;\r\n        }\r\n        this.onDestroy.emit();\r\n    }\r\n\r\n    /**\r\n     * 获取UE实例\r\n     *\r\n     * @readonly\r\n     */\r\n    get Instance(): any {\r\n        return this.instance;\r\n    }\r\n\r\n    /**\r\n     * 设置编辑器语言\r\n     *\r\n     * @param {('zh-cn' | 'en')} lang\r\n     */\r\n    setLanguage(lang: 'zh-cn' | 'en') {\r\n        this.ss.loadScript(`${this.path}/lang/${lang}/${lang}.js`).then(res => {\r\n            this.destroy();\r\n\r\n            // 清空语言\r\n            if (!UE._bak_I18N) {\r\n                UE._bak_I18N = UE.I18N;\r\n            }\r\n            UE.I18N = {};\r\n            UE.I18N[lang] = UE._bak_I18N[ lang ];\r\n\r\n            this.init();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 添加编辑器事件\r\n     */\r\n    addListener(eventName: EventTypes, fn: Function): void {\r\n        if (this.events[eventName]) return;\r\n        this.events[eventName] = fn;\r\n        this.instance.addListener(eventName, fn);\r\n    }\r\n\r\n    /**\r\n     * 移除编辑器事件\r\n     */\r\n    removeListener(eventName: EventTypes): void {\r\n        if (!this.events[eventName]) return;\r\n        this.instance.removeListener(eventName, this.events[eventName]);\r\n        delete this.events[eventName];\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy();\r\n        if (this.route$) this.route$.unsubscribe();\r\n    }\r\n\r\n    writeValue(value: string): void {\r\n        this.value = value;\r\n        if (this.instance) {\r\n            this.instance.setContent(this.value);\r\n        }\r\n    }\r\n\r\n    protected onChange: any = Function.prototype;\r\n    protected onTouched: any = Function.prototype;\r\n\r\n    public registerOnChange(fn: (_: any) => {}): void { this.onChange = fn; }\r\n    public registerOnTouched(fn: () => {}): void { this.onTouched = fn; }\r\n\r\n    setDisabledState(isDisabled: boolean): void {\r\n        if (isDisabled) {\r\n            this.instance.setDisabled();\r\n        } else {\r\n            this.instance.setEnabled();\r\n        }\r\n    }\r\n}\r\n"]}