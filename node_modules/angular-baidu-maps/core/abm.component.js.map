{"version":3,"file":"abm.component.js","sourceRoot":"","sources":["../../.tmp/core/abm.component.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAyB,UAAU,EAAa,YAAY,EAAE,MAAM,EAAE,MAAM,EAA4B,iBAAiB,EAAE,MAAM,eAAe,CAAC;AAG1K,OAAO,EAAE,aAAa,EAAE,MAAM,kBAAkB,CAAC;AACjD,OAAO,EAAE,SAAS,EAAE,MAAM,cAAc,CAAC;;IAsBrC,sBAAoB,EAAc,EACd,GAAc,EACd,MAAqB,EACrB,IAAY;QAHZ,OAAE,GAAF,EAAE,CAAY;QACd,QAAG,GAAH,GAAG,CAAW;QACd,WAAM,GAAN,MAAM,CAAe;QACrB,SAAI,GAAJ,IAAI,CAAQ;uBARR,EAAE;qBACR,IAAI,YAAY,EAAO;mBAEtB,IAAI;KAKc;IAErC,+BAAQ,GAAR;QACI,IAAI,CAAC,QAAQ,EAAE,CAAC;KACnB;IAED,kCAAW,GAAX,UAAY,OAAsB;QAC9B,EAAE,CAAC,CAAC,SAAS,IAAI,OAAO,CAAC;YAAC,IAAI,CAAC,cAAc,EAAE,CAAC;KACnD;IAEO,+BAAQ,GAAhB;QAAA,iBAcC;QAbG,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;YAAC,MAAM,CAAC;QACrB,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC;YACpB,KAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;gBACxB,IAAI,CAAC;oBACD,KAAI,CAAC,GAAG,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,KAAI,CAAC,EAAE,CAAC,aAAa,EAAE,KAAI,CAAC,OAAO,CAAC,CAAC;iBAChE;gBAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;oBACV,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;iBAC/B;aACJ,CAAC,CAAC;YACH,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAI,CAAC,GAAG,CAAC,CAAC;SAC7B,CAAC,CAAC,KAAK,CAAC,UAAC,KAAY;YAClB,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;SACjC,CAAC,CAAA;KACL;IAEO,qCAAc,GAAtB;QACI,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACpE,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACX,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACrC;KACJ;IAEO,8BAAO,GAAf;QACI,EAAE,CAAA,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;YACV,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;YACzB,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;SAC5B;KACJ;IAED,kCAAW,GAAX;QACI,IAAI,CAAC,OAAO,EAAE,CAAC;KAClB;;gBA/DJ,SAAS,SAAC;oBACP,QAAQ,EAAE,SAAS;oBACnB,QAAQ,EAAE,EAAE;oBACZ,MAAM,EAAE,CAAE,2FAET,CAAE;oBACH,IAAI,EAAE;wBACF,sCAAsC,EAAE,MAAM;qBACjD;oBACD,aAAa,EAAE,iBAAiB,CAAC,IAAI;iBACxC;;;;gBAlBiD,UAAU;gBAInD,SAAS;gBADT,aAAa;gBAHyE,MAAM;;;4BAqBhG,KAAK;0BACL,MAAM;;uBAtBX;;SAmBa,YAAY","sourcesContent":["import { Component, Input, forwardRef, ViewChild, ElementRef, OnDestroy, EventEmitter, Output, NgZone, OnChanges, SimpleChanges, ViewEncapsulation } from '@angular/core';\r\nimport { Subscription } from \"rxjs/Subscription\";\r\n\r\nimport { LoaderService } from './loader.service';\r\nimport { AbmConfig } from './abm.config';\r\n\r\ndeclare const BMap: any;\r\n\r\n@Component({\r\n    selector: 'abm-map',\r\n    template: ``,\r\n    styles: [ `\r\n        .angular-baidu-maps-container { display:block; width:100%; height:100%; }\r\n    ` ],\r\n    host: {\r\n        '[class.angular-baidu-maps-container]': 'true'\r\n    },\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class AbmComponent implements OnChanges, OnDestroy {\r\n\r\n    @Input() options: any = {};\r\n    @Output() ready = new EventEmitter<any>();\r\n\r\n    private map: any = null;\r\n\r\n    constructor(private el: ElementRef,\r\n                private COG: AbmConfig, \r\n                private loader: LoaderService,\r\n                private zone: NgZone) { }\r\n\r\n    ngOnInit() {\r\n        this._initMap();\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if ('options' in changes) this._updateOptions();\r\n    }\r\n\r\n    private _initMap() {\r\n        if (this.map) return;\r\n        this.loader.load().then(() => {\r\n            this.zone.runOutsideAngular(() => {\r\n                try {\r\n                    this.map = new BMap.Map(this.el.nativeElement, this.options);\r\n                } catch (ex) {\r\n                    console.warn('地图初始化失败', ex);\r\n                }\r\n            });\r\n            this.ready.emit(this.map);\r\n        }).catch((error: Error) => {\r\n            console.warn('js加载失败', error);\r\n        })\r\n    }\r\n\r\n    private _updateOptions() {\r\n        this.options = Object.assign({}, this.COG.mapOptions, this.options);\r\n        if (this.map) {\r\n            this.map.setOptions(this.options);\r\n        }\r\n    }\r\n\r\n    private destroy() {\r\n        if(this.map) {\r\n            this.map.clearOverlays();\r\n            this.map.clearHotspots();\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        this.destroy();\r\n    }\r\n}\r\n"]}